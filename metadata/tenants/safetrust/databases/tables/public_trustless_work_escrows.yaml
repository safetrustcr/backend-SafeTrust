table:
  name: trustless_work_escrows
  schema: public
configuration:
  column_config:
    id:
      custom_name: id
    contract_id:
      custom_name: contractId
    escrow_type:
      custom_name: escrowType
    asset_code:
      custom_name: assetCode
    asset_issuer:
      custom_name: assetIssuer
    booking_id:
      custom_name: bookingId
    room_id:
      custom_name: roomId
    hotel_id:
      custom_name: hotelId
    guest_id:
      custom_name: guestId
    check_in_date:
      custom_name: checkInDate
    check_out_date:
      custom_name: checkOutDate
    booking_created_at:
      custom_name: bookingCreatedAt
    escrow_metadata:
      custom_name: escrowMetadata
    booking_metadata:
      custom_name: bookingMetadata
    created_at:
      custom_name: createdAt
    updated_at:
      custom_name: updatedAt
    tenant_id:
      custom_name: tenantId
  custom_column_names:
    contract_id: contractId
    escrow_type: escrowType
    asset_code: assetCode
    asset_issuer: assetIssuer
    booking_id: bookingId
    room_id: roomId
    hotel_id: hotelId
    guest_id: guestId
    check_in_date: checkInDate
    check_out_date: checkOutDate
    booking_created_at: bookingCreatedAt
    escrow_metadata: escrowMetadata
    booking_metadata: bookingMetadata
    created_at: CreatedAt
    updated_at: UpdatedAt
    tenant_id: TenantId
  custom_root_fields: {}
  custom_name: trustlessWorkEscrows
array_relationships:
  - name: milestones
    using:
      foreign_key_constraint_on:
        column: escrow_id
        table:
          name: escrow_milestones
          schema: public
  - name: webhookEvents
    using:
      foreign_key_constraint_on:
        column: contract_id
        table:
          name: trustless_work_webhook_events
          schema: public
object_relationships: []
select_permissions:
  - role: anonymous
    permission:
      columns: []
      filter: {}
    comment: "Anonymous users cannot access trustless work escrows"
  - role: user
    permission:
      columns:
        - id
        - contract_id
        - escrow_type
        - status
        - asset_code
        - asset_issuer
        - amount
        - balance
        - booking_id
        - room_id
        - hotel_id
        - guest_id
        - check_in_date
        - check_out_date
        - booking_created_at
        - escrow_metadata
        - created_at
        - updated_at
        - tenant_id
      filter:
        _and:
          - tenant_id:
              _eq: X-Hasura-Tenant-Id
          - _or:
              - guest_id:
                  _eq: X-Hasura-User-Id
              - marker:
                  _eq: X-Hasura-User-Id
      comment: "Users can see escrows they are involved in as guest or marker"
  - role: admin
    permission:
      columns: "*"
      filter:
        tenant_id:
          _eq: X-Hasura-Tenant-Id
      comment: "Admins can view all escrows in their tenant"
insert_permissions:
  - role: user
    permission:
      check:
        _and:
          - tenant_id:
              _eq: X-Hasura-Tenant-Id
          - guest_id:
              _eq: X-Hasura-User-Id
      columns:
        - contract_id
        - escrow_type
        - asset_code
        - asset_issuer
        - amount
        - booking_id
        - room_id
        - hotel_id
        - check_in_date
        - check_out_date
        - escrow_metadata
        - booking_metadata
      set:
        tenant_id: X-Hasura-Tenant-Id
        guest_id: X-Hasura-User-Id
      comment: "Users can create escrows as guests in their tenant"
  - role: admin
    permission:
      check:
        tenant_id:
          _eq: X-Hasura-Tenant-Id
      columns:
        - contract_id
        - marker
        - approver
        - releaser
        - resolver
        - escrow_type
        - status
        - asset_code
        - asset_issuer
        - amount
        - balance
        - booking_id
        - room_id
        - hotel_id
        - guest_id
        - check_in_date
        - check_out_date
        - booking_created_at
        - escrow_metadata
        - booking_metadata
      set:
        tenant_id: X-Hasura-Tenant-Id
      comment: "Admins can create and manage escrows in their tenant"
update_permissions:
  - role: user
    permission:
      columns:
        - status
        - balance
        - escrow_metadata
        - updated_at
      filter:
        _and:
          - tenant_id:
              _eq: X-Hasura-Tenant-Id
          - guest_id:
              _eq: X-Hasura-User-Id
      check:
        _and:
          - tenant_id:
              _eq: X-Hasura-Tenant-Id
          - guest_id:
              _eq: X-Hasura-User-Id
      comment: "Users can update their own escrow status in their tenant"
  - role: admin
    permission:
      columns:
        - status
        - balance
        - marker
        - approver
        - releaser
        - resolver
        - escrow_metadata
        - booking_metadata
        - updated_at
      filter:
        tenant_id:
          _eq: X-Hasura-Tenant-Id
      check:
        tenant_id:
          _eq: X-Hasura-Tenant-Id
      comment: "Admins can manage all escrow properties in their tenant"
delete_permissions:
  - role: user
    permission:
      filter:
        _and:
          - tenant_id:
              _eq: X-Hasura-Tenant-Id
          - guest_id:
              _eq: X-Hasura-User-Id
      comment: "Users can delete their own escrows in their tenant"
  - role: admin
    permission:
      filter:
        tenant_id:
          _eq: X-Hasura-Tenant-Id
      comment: "Admins can delete any escrow in their tenant"
