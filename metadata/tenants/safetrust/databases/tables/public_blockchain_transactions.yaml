table:
  name: blockchain_transactions
  schema: public
object_relationships:
  - name: escrow_transaction
    using:
      foreign_key_constraint_on: escrow_transaction_id
select_permissions:
  - role: user
    permission:
      columns:
        - id
        - transaction_hash
        - escrow_transaction_id
        - network
        - status
        - confirmations
        - required_confirmations
        - block_number
        - gas_used
        - gas_price
        - from_address
        - to_address
        - value
        - metadata
        - created_at
        - updated_at
        - confirmed_at
      filter:
        escrow_transaction:
          escrow_transaction_users:
            user_id:
              _eq: X-Hasura-User-Id
      allow_aggregations: true
    comment: "Users can see blockchain transactions for their escrows"
  - role: landlord
    permission:
      columns:
        - id
        - transaction_hash
        - escrow_transaction_id
        - network
        - status
        - confirmations
        - required_confirmations
        - block_number
        - gas_used
        - gas_price
        - from_address
        - to_address
        - value
        - metadata
        - created_at
        - updated_at
        - confirmed_at
      filter:
        escrow_transaction:
          escrow_transaction_users:
            user_id:
              _eq: X-Hasura-User-Id
      allow_aggregations: true
    comment: "Landlords can see blockchain transactions for their escrows"
  - role: tenant
    permission:
      columns:
        - id
        - transaction_hash
        - escrow_transaction_id
        - network
        - status
        - confirmations
        - required_confirmations
        - block_number
        - gas_used
        - gas_price
        - from_address
        - to_address
        - value
        - metadata
        - created_at
        - updated_at
        - confirmed_at
      filter:
        escrow_transaction:
          escrow_transaction_users:
            user_id:
              _eq: X-Hasura-User-Id
      allow_aggregations: true
    comment: "Tenants can see blockchain transactions for their escrows"
insert_permissions:
  - role: user
    permission:
      check: {}
      columns:
        - transaction_hash
        - escrow_transaction_id
        - network
        - status
        - confirmations
        - required_confirmations
        - block_number
        - gas_used
        - gas_price
        - from_address
        - to_address
        - value
        - metadata
      backend_only: true
    comment: "Blockchain transactions are typically created by backend/webhooks"
update_permissions:
  - role: user
    permission:
      filter: {}
      columns:
        - status
        - confirmations
        - block_number
        - gas_used
        - gas_price
        - confirmed_at
        - metadata
      backend_only: true
    comment: "Blockchain transactions are typically updated by backend/webhooks"
