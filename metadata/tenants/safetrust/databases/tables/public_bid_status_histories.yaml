table:
  name: bid_status_histories
  schema: public
object_relationships:
  - name: bid_request
    using:
      foreign_key_constraint_on: bid_request_id
select_permissions:
  - role: anonymous
    permission:
      columns: []
      filter: {}
    comment: "Anonymous users cannot access bid history"
  - role: user
    permission:
      columns:
        - id
        - bid_request_id
        - status
        - notes
        - changed_by
        - created_at
      filter:
        bid_request:
          _or:
            - tenant_id:
                _eq: X-Hasura-User-Id
            - apartment:
                owner_id:
                  _eq: X-Hasura-User-Id
      comment: "Users can see status history for bids they made or on their apartments"
  - role: admin
    permission:
      columns: "*"
      filter:
        bid_request:
          apartment:
            owner_id:
              _neq: ""
      comment: "Admins can view all bid status histories in their tenant"
insert_permissions:
  - role: admin
    permission:
      check:
        bid_request:
          apartment:
            owner_id:
              _neq: ""
      columns:
        - bid_request_id
        - status
        - notes
      set:
        changed_by: X-Hasura-User-Id
      comment: "Admins can record bid status changes for bids in their tenant"
delete_permissions:
  - role: admin
    permission:
      filter:
        bid_request:
          apartment:
            owner_id:
              _neq: ""
      comment: "Admins can delete bid history entries in their tenant"
