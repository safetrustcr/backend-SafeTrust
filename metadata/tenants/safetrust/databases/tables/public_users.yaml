table:
  name: users
  schema: public
array_relationships:
  - name: user_wallets
    using:
      foreign_key_constraint_on:
        column: user_id
        table:
          name: user_wallets
          schema: public
select_permissions:
  - role: anonymous
    permission:
      columns: []
      filter: {}
    comment: "Anonymous users cannot view any user data"
  - role: user
    permission:
      columns:
        - id
        - email
        - last_seen
      filter:
        # Row-level security: users can only see their own profile
        id:
          _eq: X-Hasura-User-Id
      comment: "Users can only see their own profile"
  - role: admin
    permission:
      columns:
        - id
        - email
        - last_seen
      filter:
        # Admins can view all users in their tenant
        id:
          _neq: ""
      comment: "Admins can view all users in their tenant"
insert_permissions:
  - role: user
    permission:
      check:
        # Row-level security: users can only create records for themselves
        id:
          _eq: X-Hasura-User-Id
      columns:
        - id
        - email
      comment: "Users can only create records for themselves"
  - role: admin
    permission:
      check:
        id:
          _neq: ""
      columns:
        - id
        - email
      comment: "Admins can create user records in their tenant"
update_permissions:
  - role: user
    permission:
      columns:
        - last_seen
      filter:
        # Row-level security: users can only update their own profile
        id:
          _eq: X-Hasura-User-Id
      check:
        id:
          _eq: X-Hasura-User-Id
      comment: "Users can only update their own last_seen timestamp"
  - role: admin
    permission:
      columns:
        - email
        - last_seen
      filter:
        id:
          _neq: ""
      check:
        id:
          _neq: ""
      comment: "Admins can update user information in their tenant"
delete_permissions:
  - role: admin
    permission:
      filter:
        id:
          _neq: ""
      comment: "Admins can delete users in their tenant"
