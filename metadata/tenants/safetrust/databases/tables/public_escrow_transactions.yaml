table:
  name: escrow_transactions
  schema: public
  columns:
    - name: id
      type: uuid
    - name: bid_request_id
      type: uuid
    - name: engagement_id
      type: text
    - name: contract_id
      type: text
    - name: signer_address
      type: text
    - name: transaction_type
      type: escrow_transaction_type
    - name: status
      type: escrow_status
    - name: http_status_code
      type: integer
    - name: http_response_body
      type: jsonb
    - name: http_error_details
      type: jsonb
    - name: amount
      type: numeric
    - name: initial_deposit_percentage
      type: integer
    - name: cancellation_reason
      type: text
    - name: cancelled_by
      type: text
    - name: refund_status
      type: escrow_status
    - name: metadata
      type: jsonb
    - name: created_at
      type: timestamptz
    - name: updated_at
      type: timestamptz
    - name: completed_at
      type: timestamptz
  object_relationships:
    - name: bid_request
      using:
        foreign_key_constraint_on: bid_request_id
    - name: cancelled_by_user
      using:
        foreign_key_constraint_on: cancelled_by
  array_relationships:
    - name: xdr_transactions
      using:
        foreign_key_constraint_on:
          column: escrow_transaction_id
          table: escrow_xdr_transactions
    - name: api_calls
      using:
        foreign_key_constraint_on:
          column: escrow_transaction_id
          table: escrow_api_calls
event_triggers:
  - name: on_escrow_created
    definition:
      enable_manual: true
      insert:
        columns: "*"
    retry_conf:
      interval_sec: 10
      num_retries: 3
      timeout_sec: 60
    webhook: "{{WEBHOOK_URL}}/events/escrow-created"
    headers:
      - name: x-hasura-admin-secret
        value_from_env: HASURA_GRAPHQL_ADMIN_SECRET
  - name: on_fund_released
    definition:
      enable_manual: true
      update:
        columns:
          - status
        condition:
          status:
            _eq: "released"
    retry_conf:
      interval_sec: 10
      num_retries: 3
      timeout_sec: 60
    webhook: "{{WEBHOOK_URL}}/events/fund-released"
    headers:
      - name: x-hasura-admin-secret
        value_from_env: HASURA_GRAPHQL_ADMIN_SECRET
  - name: on_refund_requested
    definition:
      enable_manual: true
      update:
        columns:
          - refund_status
          - cancellation_reason
          - cancelled_by
        condition:
          _or:
            - refund_status:
                _is_null: false
            - cancellation_reason:
                _is_null: false
    retry_conf:
      interval_sec: 10
      num_retries: 3
      timeout_sec: 60
    webhook: "{{WEBHOOK_URL}}/events/refund-requested"
    headers:
      - name: x-hasura-admin-secret
        value_from_env: HASURA_GRAPHQL_ADMIN_SECRET