table:
  name: escrow_transaction_users
  schema: public
columns:
  - name: id
    type: uuid
    is_primary_key: true
    default: "uuid_generate_v4()"
  - name: user_email
    type: varchar(150)
    references:
      table: public.users
      column: email
  - name: escrow_transaction_id
    type: uuid
    references:
      table: public.escrow_transactions
      column: id
  - name: role
    type: varchar(20)
  - name: status
    type: varchar(20)
  - name: is_primary
    type: boolean
    default: "false"
  - name: created_at
    type: timestamptz
    default: "now()"
  - name: updated_at
    type: timestamptz
    default: "now()"
  - name: funded_at
    type: timestamptz
    is_nullable: true
  - name: funding_status
    type: varchar(20)
    default: "'PENDING'"
constraints:
  - name: unique_escrow_user_role
    type: unique
    columns:
      - escrow_transaction_id
      - user_email
      - role
indexes:
  - name: idx_escrow_transaction_users_transaction_id
    columns:
      - escrow_transaction_id
  - name: idx_escrow_transaction_users_user_id
    columns:
      - user_email
  - name: idx_escrow_transaction_users_funding_status
    columns:
      - funding_status
object_relationships:
  - name: user
    using:
      foreign_key_constraint_on: user_email
  - name: escrow_transaction
    using:
      foreign_key_constraint_on: escrow_transaction_id
select_permissions:
  - role: user
    permission:
      columns:
        - id
        - user_email
        - escrow_transaction_id
        - role
        - status
        - is_primary
        - created_at
        - updated_at
        - funded_at
        - funding_status
      filter: {}
insert_permissions:
  - role: admin
    permission:
      check: {}
      columns:
        - user_email
        - escrow_transaction_id
        - role
        - status
        - is_primary
        - created_at
        - updated_at
        - funded_at
        - funding_status
update_permissions:
  - role: admin
    permission:
      filter: {}
      columns:
        - user_email
        - escrow_transaction_id
        - role
        - status
        - is_primary
        - created_at
        - updated_at
        - funded_at
        - funding_status
delete_permissions:
  - role: admin
    permission:
      filter: {}